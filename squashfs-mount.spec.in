Name:           squashfs-mount
Version:        SQMNT_VERSION
Release:        1%{?dist}
Summary:        setuid mount squashfs utility.
Prefix:         /usr

License:        BSD3
URL:            https://github.com/eth-cscs/squashfs-mount
Source0:        %{name}-%{version}.tar.gz

%define _build_id_links none

%description
A small setuid binary that mounts a squashfs image in a mount namespace then executes a command as the normal user.

%prep
%setup -q

%build
LDFLAGS="-llz4 -lzstd -llzma -llzo2 -lz" make %{?_smp_mflags}

%install
make install-suid prefix=%{_prefix} DESTDIR=%{buildroot}

%files
%license LICENSE
%{_bindir}/%{name}
%{_bindir}/%{name}-rootless
